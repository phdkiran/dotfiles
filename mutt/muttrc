set from = 'hi@romanzolotarev.com'
set realname = 'Roman Zolotarev'
set folder = '~/Mail'

alternates `get-password fastmail-alternatives | sed "s/\./\\\./g"`
set my_username = `get-password fastmail-username`
set sendmail = "/usr/local/bin/msmtp -a FastMail --user $my_username"
set sendmail_wait = -1
# set my_password = `get-password fastmail-password`
# set smtp_url = "smtps://$my_username@mail.messagingengine.com"
# set smtp_authenticators = 'gssapi:login'
# set smtp_pass = "$my_password"

set my_inbox = 'INBOX'
set my_archive = 'INBOX.Archive'
set my_drafts = 'INBOX.Drafts'
set my_sent = 'INBOX.Sent<quote-char> Items'
set my_junk = 'INBOX.Junk<quote-char> Mail'
set my_notes = 'INBOX.Notes'
set my_trash = 'INBOX.Trash'

set reply_self = no
set fcc_attach = yes
set alias_file = '~/.mutt/aliases'
set certificate_file = '~/.mutt/certificates'
set header_cache = '~/.mutt/cache/headers'
set mailcap_path = '~/.mutt/mailcap'
set message_cachedir = '~/.mutt/cache/messages'
source $alias_file
source ~/.mutt/colors

# unset markers
set copy = yes # Save a copy of sent mail
set delete = ask-yes # Confirm and purge deleted when leaving a folder
set display_filter = '~/.mutt/display-filter'
set fast_reply = yes
set folder_format = '%f %> %N'
set include = yes # Always quote in replies
set index_format = '%[%Y-%m-%d %H:%M] %Z  %35L %3M %s'
set mail_check = 0 # Minimum time between email checks
set mark_old = no # Only move read emails when they're actually looked at
set pager_format = "$index_format %> %P"
set pager_index_lines = 4 # Show index in pager
set postponed = "+$my_drafts"
set query_command = "contacts '%s'"
set read_inc = 1000 # Don't update read counts very frequently when loading large mailboxes
set record = "=INBOX.Sent Items"
set reverse_alias = yes
set reverse_name = yes
set sleep_time = 0
set sort = threads # Sort by threads
set sort_alias = alias
set sort_aux = reverse-last-date-received
set spoolfile = "=$my_inbox"
set status_format = '%-51.51f %r %?n? %n new ?%?d? %d deleted ?%?t? %t tagged ?%?p? %p postponed ? %?m?of %m&is empty?%> %P'
set text_flowed = yes
set timeout = 3 # Look for email after three seconds of inactivity
set use_envelope_from = yes
set use_from = yes
set wait_key = no # Don't wait after running external command

# macro index,pager,attach go '<sync-mailbox><shell-escape>~/.mutt/single-offlineimap &<enter>' 'Sync offlineimap'
macro index L "<enter-command>unset wait_key<enter><shell-escape>notmuch new; read -p 'notmuch query: ' x; echo \$x >~/.cache/mutt_terms<enter><limit>~i \"\`notmuch search --output=messages \$(cat ~/.cache/mutt_terms) | head -n 600 | perl -le '@a=<>;chomp@a;s/\^id:// for@a;$,=\"|\";print@a'\`\"<enter>" 'show only messages matching a notmuch pattern'
macro index a '<limit>all<enter>' 'Show all messages (undo limit)'
macro index gr ':source ~/.mutt/muttrc<enter>' 'Source muttrc'
macro index,pager A '<pipe-message>pycard-import<enter>' 'add sender address to pycardsyncer'
macro index,pager R <group-reply>
macro index,pager S "<save-message>=$my_junk<enter>"
macro index,pager X '<pipe-message>ripmime -i - --no-nameless -d ~/Downloads/'
macro index,pager \cb <pipe-entry>'urlview'<enter> 'Open links'
macro index,pager gA "<change-folder>=$my_archive<enter>" 'Go to Archive'
macro index,pager ga "<change-folder>=$my_archive." 'Go to ...'
macro index,pager gd "<change-folder>=$my_drafts<enter>" 'Go to Drafts'
macro index,pager gi "<change-folder>=$my_inbox<enter>" 'Go to Inbox'
macro index,pager gj "<change-folder>=$my_junk<enter>" 'Go to Junk'
macro index,pager gl '<change-folder>?'
macro index,pager gn "<change-folder>=$my_notes<enter>" 'Go to Notes'
macro index,pager gs "<change-folder>=$my_sent<enter>" 'Go to Sent'
macro index,pager gt "<change-folder>=$my_trash<enter>" 'Go to Trash'
macro index,pager s "<save-message>=$my_archive."
macro pager H <view-attachments>/html<enter><view-mailcap><exit>

bind compose p postpone-message
bind editor <tab> complete-query
bind editor ^T complete
bind index <space> collapse-thread
bind index G last-entry
bind index _ collapse-all
bind index gg first-entry
bind index j next-entry
bind index k previous-entry
bind index,pager \# noop
bind index,pager \& noop
bind index,pager \cD noop
bind pager / search
bind pager G bottom
bind pager gg top
bind pager j next-line
bind pager k previous-line

folder-hook . 'exec collapse-all'

# Headers
ignore *
unignore from to cc 
unhdr_order *
hdr_order from to cc

# Strip HTML tags
auto_view text/html
alternative_order text/plain text/enriched text/html
