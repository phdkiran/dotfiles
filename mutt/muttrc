set from = 'hi@romanzolotarev.com'
set realname = 'Roman Zolotarev'
set folder = '~/Mail'

alternates `get-password fastmail-alternatives | sed "s/\./\\\./g"`
set my_username = `get-password fastmail-username`
set sendmail = "/usr/local/bin/msmtp -a FastMail --user $my_username"
set sendmail_wait = -1
# set my_password = `get-password fastmail-password`
# set smtp_url = "smtps://$my_username@mail.messagingengine.com"
# set smtp_authenticators = 'gssapi:login'
# set smtp_pass = "$my_password"

set my_inbox = 'Inbox'
set my_archive = 'Archive'
set my_drafts = 'Drafts'
set my_sent = 'Sent<quote-char> Items'
set my_junk = 'Junk<quote-char> Mail'
set my_notes = 'Notes'
set my_trash = 'Trash'

set crypt_autosign = no
set crypt_replysignencrypted = yes
set crypt_verify_sig = yes
set my_hdr = "X-PGP-Key: https://keybase.io/roman/key.asc"
set pgp_clearsign_command = "gpg --no-verbose --batch --output - --passphrase-fd 0 --armor --textmode --clearsign %?a?-u %a? %f"
set pgp_decode_command = "gpg %?p?--passphrase-fd 0? --no-verbose --batch --output - %f"
set pgp_decrypt_command = "gpg --passphrase-fd 0 --no-verbose --batch --output - %f"
set pgp_encrypt_only_command = "pgpewrap gpg --batch --quiet --no-verbose --output - --encrypt --textmode --armor --always-trust --encrypt-to FA3280A3 -- -r %r -- %f"
set pgp_encrypt_sign_command = "pgpewrap gpg --passphrase-fd 0 --batch --quiet --no-verbose --textmode --output - --encrypt --sign %?a?-u %a? --armor --always-trust --encrypt-to FA3280A3 -- -r %r -- %f"
set pgp_export_command = "gpg --no-verbose --export --armor %r"
set pgp_good_sign = "^gpg: Good signature from"
set pgp_import_command = "gpg --no-verbose --import -v %f"
set pgp_list_pubring_command = "gpg --no-verbose --batch --with-colons --list-keys %r"
set pgp_list_secring_command = "gpg --no-verbose --batch --with-colons --list-secret-keys %r"
set pgp_sign_as = FA3280A3
set pgp_sign_command = "gpg --no-verbose --batch --output - --passphrase-fd 0 --armor --detach-sign --textmode %?a?-u %a? %f"
set pgp_timeout = 3600
set pgp_use_gpg_agent = yes
set pgp_verify_command = "gpg --no-verbose --batch --output - --verify %s %f"
set pgp_verify_key_command = "gpg --no-verbose --batch --fingerprint --check-sigs %r"
set pgp_show_unusable = no

set reply_self = no
set fcc_attach = yes
set alias_file = '~/.mutt/aliases'
set certificate_file = '~/.mutt/certificates'
set header_cache = '~/.mutt/cache/headers'
set mailcap_path = '~/.mutt/mailcap'
set message_cachedir = '~/.mutt/cache/messages'
source $alias_file
source ~/.mutt/colors

# unset markers
set confirmappend = no
set copy = yes # Save a copy of sent mail
set delete = ask-yes # Confirm and purge deleted when leaving a folder
set display_filter = '~/.mutt/display-filter'
set fast_reply = yes
set folder_format = '%f %> %N'
set include = yes # Always quote in replies
set index_format = '%[%Y-%m-%d %H:%M] %Z  %35L %3M %s'
set mail_check = 0 # Minimum time between email checks
set mark_old = no # Only move read emails when they're actually looked at
set pager_format = "$index_format %> %P"
# set pager_index_lines = 10 # Show index in pager
set postponed = "=$my_drafts"
set query_command = "pc_query -m '%s'"
set read_inc = 1000 # Don't update read counts very frequently when loading large mailboxes
set record = "=Sent Items"
set reverse_alias = yes
set reverse_name = yes
set sleep_time = 0
set sort = threads # Sort by threads
set sort_alias = alias
set sort_aux = reverse-last-date-received
set spoolfile = "=$my_inbox"
set status_format = '%-51.51f %r %?n? %n new ?%?d? %d deleted ?%?t? %t tagged ?%?p? %p postponed ? %?m?of %m&is empty?%> %P'
set text_flowed = yes
set timeout = 3 # Look for email after three seconds of inactivity
set use_envelope_from = yes
set use_from = yes
set wait_key = no # Don't wait after running external command

# macro index,pager,attach go '<sync-mailbox><shell-escape>~/.mutt/single-offlineimap &<enter>' 'Sync offlineimap'
macro index L "<enter-command>unset wait_key<enter><shell-escape>notmuch new; read -p 'notmuch query: ' x; echo \$x >~/.cache/mutt_terms<enter><limit>~i \"\`notmuch search --output=messages \$(cat ~/.cache/mutt_terms) | head -n 600 | perl -le '@a=<>;chomp@a;s/\^id:// for@a;$,=\"|\";print@a'\`\"<enter>" 'show only messages matching a notmuch pattern'
macro index a '<limit>all<enter>' 'Show all messages (undo limit)'
macro index gR ':source ~/.mutt/muttrc<enter>' 'Source muttrc'
macro index,pager A '<pipe-message>pycard-import<enter>' 'add sender address to pycardsyncer'
macro index,pager R <group-reply>
macro index,pager S "<save-message>=$my_junk<enter>"
macro index,pager X '<pipe-message>ripmime -i - --no-nameless -d ~/Downloads/'
macro index,pager \cb <pipe-entry>'urlview'<enter> 'Open links'
macro index,pager gA "<change-folder>=$my_archive<enter>" 'Go to Archive'
macro index,pager ga "<change-folder>=$my_archive." 'Go to ...'
macro index,pager gd "<change-folder>=$my_drafts<enter>" 'Go to Drafts'
macro index,pager gi "<change-folder>=$my_inbox<enter>" 'Go to Inbox'
macro index,pager gj "<change-folder>=$my_junk<enter>" 'Go to Junk'
macro index,pager gl '<change-folder>?'
macro index,pager gn "<change-folder>=$my_notes<enter>" 'Go to Notes'
macro index,pager gr "<change-folder>=$my_archive.romanzolotarev<enter>" 'Go to Archive/romanzolotarev'
macro index,pager gs "<change-folder>=$my_sent<enter>" 'Go to Sent'
macro index,pager gt "<change-folder>=$my_trash<enter>" 'Go to Trash'
macro index,pager s '<save-message><tab>'
macro index,pager H <view-attachments>/html<enter><view-mailcap><exit>

bind editor <tab> complete-query
bind editor ^T complete
bind index <space> collapse-thread
bind index G last-entry
bind index _ collapse-all
bind index gg first-entry
bind index j next-entry
bind index k previous-entry
bind index,pager \# noop
bind index,pager \& noop
bind index,pager \cD noop
bind index,pager x delete-message
bind pager / search
bind pager G bottom
bind pager gg top
bind pager j next-line
bind pager k previous-line
bind compose p pgp-menu

message-hook . 'exec toggle-quoted'
# folder-hook . 'exec collapse-all'
save-hook '~t hi@romanzolotarev\.com$' "=$my_archive.romanzolotarev"
save-hook '~f hi@romanzolotarev\.com$' "=$my_archive.romanzolotarev"
save-hook '~t @cinarra\.com$' "=$my_archive.cinarra"
save-hook '~f @cinarra\.com$' "=$my_archive.cinarra"
save-hook '^' "=$my_archive."

# Headers
ignore *
unignore from to cc
unhdr_order *
hdr_order from to cc

# Strip HTML tags
auto_view text/html
alternative_order text/plain text/enriched text/html

subscribe mutt-user
